% This script downloads the CT1088 and CT1089 datasets from the ONS
% website.

if ~exist('data','dir')
    mkdir data;
end
if ~exist('data/CT1088_tables','dir')
    mkdir data/CT1088_tables;
end

url={'https://www.ons.gov.uk/redir/eyJhbGciOiJIUzI1NiJ9.eyJpbmRleCI6MSwicGFnZVNpemUiOjI1LCJ0ZXJtIjoiQ1QxMDg4KiIsInBhZ2UiOjEsInVyaSI6Ii9wZW9wbGVwb3B1bGF0aW9uYW5kY29tbXVuaXR5L3BvcHVsYXRpb25hbmRtaWdyYXRpb24vcG9wdWxhdGlvbmVzdGltYXRlcy9hZGhvY3MvMTE1NTljdDEwODgyMDExY2Vuc3Vzc291dGhlYXN0cGFydDJhc2hmb3JkdG93b3J0aGluZyIsImxpc3RUeXBlIjoic2VhcmNoZGF0YSJ9.8beNcigHYSJwfkI1iEkeUmOWMaf7az7G5nZq0RdCt00',...
    'https://www.ons.gov.uk/redir/eyJhbGciOiJIUzI1NiJ9.eyJpbmRleCI6MiwicGFnZVNpemUiOjI1LCJ0ZXJtIjoiQ1QxMDg4KiIsInBhZ2UiOjEsInVyaSI6Ii9wZW9wbGVwb3B1bGF0aW9uYW5kY29tbXVuaXR5L3BvcHVsYXRpb25hbmRtaWdyYXRpb24vcG9wdWxhdGlvbmVzdGltYXRlcy9hZGhvY3MvMTE1NTdjdDEwODgyMDExY2Vuc3Vzc291dGhlYXN0cGFydDFicmFja25lbGxmb3Jlc3R1YXRvd2luY2hlc3RlciIsImxpc3RUeXBlIjoic2VhcmNoZGF0YSJ9.u5ZolpAu5hqqktMkg48bzjaC3UbNxEffMgp7TNCtu68',...
    'https://www.ons.gov.uk/redir/eyJhbGciOiJIUzI1NiJ9.eyJpbmRleCI6MywicGFnZVNpemUiOjI1LCJ0ZXJtIjoiQ1QxMDg4KiIsInBhZ2UiOjEsInVyaSI6Ii9wZW9wbGVwb3B1bGF0aW9uYW5kY29tbXVuaXR5L3BvcHVsYXRpb25hbmRtaWdyYXRpb24vcG9wdWxhdGlvbmVzdGltYXRlcy9hZGhvY3MvMTE1NzNjdDEwODgyMDExY2Vuc3Vzbm9ydGh3ZXN0cGFydDFibGFja2J1cm53aXRoZGFyd2VudWF0b3dpZ2FuIiwibGlzdFR5cGUiOiJzZWFyY2hkYXRhIn0.-_9CMhqsSa9829h1qS9kXgF4IqH7h2NoLWzIZC5uBxk',...
    'https://www.ons.gov.uk/redir/eyJhbGciOiJIUzI1NiJ9.eyJpbmRleCI6NCwicGFnZVNpemUiOjI1LCJ0ZXJtIjoiQ1QxMDg4KiIsInBhZ2UiOjEsInVyaSI6Ii9wZW9wbGVwb3B1bGF0aW9uYW5kY29tbXVuaXR5L3BvcHVsYXRpb25hbmRtaWdyYXRpb24vcG9wdWxhdGlvbmVzdGltYXRlcy9hZGhvY3MvMTE1NjNjdDEwODgyMDExY2Vuc3Vzd2FsZXMiLCJsaXN0VHlwZSI6InNlYXJjaGRhdGEifQ.qhhe7KqEQ_i1N5MznM-ajejlBP8Rza5qj3dXB1VYj_c',...
    'https://www.ons.gov.uk/redir/eyJhbGciOiJIUzI1NiJ9.eyJpbmRleCI6NSwicGFnZVNpemUiOjI1LCJ0ZXJtIjoiQ1QxMDg4KiIsInBhZ2UiOjEsInVyaSI6Ii9wZW9wbGVwb3B1bGF0aW9uYW5kY29tbXVuaXR5L3BvcHVsYXRpb25hbmRtaWdyYXRpb24vcG9wdWxhdGlvbmVzdGltYXRlcy9hZGhvY3MvMTE1NzVjdDEwODgyMDExY2Vuc3Vzbm9ydGh3ZXN0cGFydDJidXJubGV5dG93aXJyYWwiLCJsaXN0VHlwZSI6InNlYXJjaGRhdGEifQ.5dnuuxFJOVkrBLz4QvN_zL0m7ANNe2z7qaCP3WRcwp4',...
    'https://www.ons.gov.uk/redir/eyJhbGciOiJIUzI1NiJ9.eyJpbmRleCI6NiwicGFnZVNpemUiOjI1LCJ0ZXJtIjoiQ1QxMDg4KiIsInBhZ2UiOjEsInVyaSI6Ii9wZW9wbGVwb3B1bGF0aW9uYW5kY29tbXVuaXR5L3BvcHVsYXRpb25hbmRtaWdyYXRpb24vcG9wdWxhdGlvbmVzdGltYXRlcy9hZGhvY3MvMTE1NjBjdDEwODgyMDExY2Vuc3VzZWFzdG1pZGxhbmRzIiwibGlzdFR5cGUiOiJzZWFyY2hkYXRhIn0.nOdBVELAjVUd1ZApDnE1VMzjgJB6jABpj5aM8Rvy3NM',...
    'https://www.ons.gov.uk/redir/eyJhbGciOiJIUzI1NiJ9.eyJpbmRleCI6NywicGFnZVNpemUiOjI1LCJ0ZXJtIjoiQ1QxMDg4KiIsInBhZ2UiOjEsInVyaSI6Ii9wZW9wbGVwb3B1bGF0aW9uYW5kY29tbXVuaXR5L3BvcHVsYXRpb25hbmRtaWdyYXRpb24vcG9wdWxhdGlvbmVzdGltYXRlcy9hZGhvY3MvMTE1NjRjdDEwODgyMDExY2Vuc3VzZWFzdG9mZW5nbGFuZCIsImxpc3RUeXBlIjoic2VhcmNoZGF0YSJ9.qmWoMQ0Fo4LSHyUuqb0imXFfOpplQyHBW7-jHxMkHNY',...
    'https://www.ons.gov.uk/redir/eyJhbGciOiJIUzI1NiJ9.eyJpbmRleCI6OCwicGFnZVNpemUiOjI1LCJ0ZXJtIjoiQ1QxMDg4KiIsInBhZ2UiOjEsInVyaSI6Ii9wZW9wbGVwb3B1bGF0aW9uYW5kY29tbXVuaXR5L3BvcHVsYXRpb25hbmRtaWdyYXRpb24vcG9wdWxhdGlvbmVzdGltYXRlcy9hZGhvY3MvMTE1NTJjdDEwODgyMDExY2Vuc3VzbG9uZG9uaW5uZXJsb25kb24iLCJsaXN0VHlwZSI6InNlYXJjaGRhdGEifQ.VDC8tVSVDJy78qCELGYRubIL060eBKmScLRJOrffMAo',...
    'https://www.ons.gov.uk/redir/eyJhbGciOiJIUzI1NiJ9.eyJpbmRleCI6OSwicGFnZVNpemUiOjI1LCJ0ZXJtIjoiQ1QxMDg4KiIsInBhZ2UiOjEsInVyaSI6Ii9wZW9wbGVwb3B1bGF0aW9uYW5kY29tbXVuaXR5L3BvcHVsYXRpb25hbmRtaWdyYXRpb24vcG9wdWxhdGlvbmVzdGltYXRlcy9hZGhvY3MvMTE1NThjdDEwODgyMDExY2Vuc3VzeW9ya3NoaXJlYW5kdGhlaHVtYmVyIiwibGlzdFR5cGUiOiJzZWFyY2hkYXRhIn0.d0at_QRpfwWbVU8TSnSuIqyEw8IUXQi9Sq5aRKtPVYU',...
    'https://www.ons.gov.uk/redir/eyJhbGciOiJIUzI1NiJ9.eyJpbmRleCI6MTAsInBhZ2VTaXplIjoyNSwidGVybSI6IkNUMTA4OCoiLCJwYWdlIjoxLCJ1cmkiOiIvcGVvcGxlcG9wdWxhdGlvbmFuZGNvbW11bml0eS9wb3B1bGF0aW9uYW5kbWlncmF0aW9uL3BvcHVsYXRpb25lc3RpbWF0ZXMvYWRob2NzLzExNTYxY3QxMDg4MjAxMWNlbnN1c3NvdXRod2VzdCIsImxpc3RUeXBlIjoic2VhcmNoZGF0YSJ9.BrJ1i8m2TTvQQtZT-JtE5g3OiJ8HSLBuXEBBOPH3hv0',...
    'https://www.ons.gov.uk/redir/eyJhbGciOiJIUzI1NiJ9.eyJpbmRleCI6MTEsInBhZ2VTaXplIjoyNSwidGVybSI6IkNUMTA4OCoiLCJwYWdlIjoxLCJ1cmkiOiIvcGVvcGxlcG9wdWxhdGlvbmFuZGNvbW11bml0eS9wb3B1bGF0aW9uYW5kbWlncmF0aW9uL3BvcHVsYXRpb25lc3RpbWF0ZXMvYWRob2NzLzExNTU0Y3QxMDg4MjAxMWNlbnN1c25vcnRoZWFzdCIsImxpc3RUeXBlIjoic2VhcmNoZGF0YSJ9.ALi2R8LPlziwCEVe95egXbu4hZy0BVGYsYM6V_VwC84',...
    'https://www.ons.gov.uk/redir/eyJhbGciOiJIUzI1NiJ9.eyJpbmRleCI6MTIsInBhZ2VTaXplIjoyNSwidGVybSI6IkNUMTA4OCoiLCJwYWdlIjoxLCJ1cmkiOiIvcGVvcGxlcG9wdWxhdGlvbmFuZGNvbW11bml0eS9wb3B1bGF0aW9uYW5kbWlncmF0aW9uL3BvcHVsYXRpb25lc3RpbWF0ZXMvYWRob2NzLzExNTYyY3QxMDg4MjAxMWNlbnN1c3dlc3RtaWRsYW5kcyIsImxpc3RUeXBlIjoic2VhcmNoZGF0YSJ9.tZmAPMEO9m6KBIYiPHvIHFnUnX2f4XNLwn-gbpzuZ0o',...
    'https://www.ons.gov.uk/redir/eyJhbGciOiJIUzI1NiJ9.eyJpbmRleCI6MTMsInBhZ2VTaXplIjoyNSwidGVybSI6IkNUMTA4OCoiLCJwYWdlIjoxLCJ1cmkiOiIvcGVvcGxlcG9wdWxhdGlvbmFuZGNvbW11bml0eS9wb3B1bGF0aW9uYW5kbWlncmF0aW9uL3BvcHVsYXRpb25lc3RpbWF0ZXMvYWRob2NzLzExNTU1Y3QxMDg4MjAxMWNlbnN1c2xvbmRvbm91dGVybG9uZG9uIiwibGlzdFR5cGUiOiJzZWFyY2hkYXRhIn0.5LzH9fOkU2PQvaqKXcdONSuuvuVISDQYBZnx_ZpTgOg'};

for table_no=1:13
    str = webread(url{table_no});
    table_loc = regexp(str,'https://([\w-]+\.)+[\w-]+(/[\w- ./?%&=]*)?(\.zip)','match')';
    filename = ['CT1088_',num2str(table_no),'.zip'];
    websave(filename,table_loc{1});
    unzip(filename,'data/CT1088_tables');
    delete(filename);
end

websave('data/CT1089.xlsx','https://www.beta.ons.gov.uk/file?uri=/peoplepopulationandcommunity/housing/adhocs/11569ct10892011census/ct10892011censuscovid19.xlsx');